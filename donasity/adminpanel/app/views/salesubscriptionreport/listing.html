<link type="text/css" rel="stylesheet" href='{#RESOURCES#}css/bootstrap-datepicker.css'>
<script type="text/javascript" src='{#RESOURCES#}js/bootstrap-datepicker.js'></script>
<script type="text/javascript">
	$(function() {
		$('#StartDate').datepicker();
		$('#StartDate').datepicker().on('changeDate', function (ev) {
			if(ev.viewMode == "days") {
				$('#StartDate').datepicker('hide');
				//maxDate: jQuery('#FromDate').datepicker("getDate");
			}
		});
		
		$('#EndDate').datepicker();
		$('#EndDate').datepicker().on('changeDate', function (ev) {
			if(ev.viewMode == "days") {
				$('#EndDate').datepicker('hide');
				//maxDate: jQuery('#ToDate').datepicker("getDate");
			}
		});
		
		
	});
	
	function ExportData() {
		var actionUrl = SITEURL + 'salesubscriptionreport/index/export';
		$('#formSection').attr('action', actionUrl);
		$('#formSection').submit();
		$('#formSection').attr('action', '');
	}
	
	function FromToDate(frequency) {
		var from_date = "{function="formatDate($fromDate, 'm/d/Y')"}";
		var to_date = "{function="formatDate($toDate, 'm/d/Y')"}";
		if(frequency == 'all') {
			$('#FromDate').val(from_date);
			$('#ToDate').val(to_date);
		} else 
			$('#FromDate, #ToDate').val('');
	}
</script>
<ul class="breadcrumb">
    <li title="Dashboard"><a href='{#URL#}home/'>Dashboard</a></li>
    <li title="Sale Subscription Report">Sale Subscription Report</li>
</ul>
{include="common/message"}
<div class="oh">
    <div class="col col-6">
        <h1 class="heading-1">Sale Subscription Report</h1>
    </div>
</div>
<div id="content-box" class="igs-form">
	<form id="formSection" name="formSection" method="get" autocomplete="off" action="">
        <input type="hidden" name="pageNumber" id="pageNumber" value="1" />
        <div class="section-heading">Filter Result <a href='javascript://' class="form-toggle-icon"><i class="fa fa-minus-square-o"></i></a></div>
        <div class="content-section">
            <fieldset>
                <div class="row">
                	<section class="col col-2">
                    	<label class="label">Status</label>
                        <label class="select">
                          <select name="dd_status" id="dd_status" class="form-control">
                          	<option value="all" {if="$dd_status=='all'"}selected{/if} >All</option>
                            <option value="1" {if="$dd_status=='1'"}selected{/if} >Approved</option>
                            <option value="0" {if="$dd_status=='0'"}selected{/if} >Declined</option>
                          </select><i></i> 
                        </label>
                    </section>                   
                    <section class="col col-2">
                        <label class="label">Service Type</label>
                        <label class="select">
                          <select name="serviceType" id="serviceType" class="form-control">
                            <option value="">All Service Type</option>
                            {if="$itemList!=''"}
                            {loop="$itemList"}
                            <option value="{$value.PI_ItemCode}" {if="$serviceType==$value.PI_ItemCode"}selected{/if} >{$value.PI_ItemName_EN}</option>
                            {/loop}
                            {/if}
                          </select><i></i> 
                        </label>
                    </section> 
                     <section class="col col-4">
                    <label class="label">Payment Mode</label>
                    <label class="checkbox pull-left mr-10"><input type="checkbox" name="payment_mode_rec" value="1" {if="$payment_mode_rec=='1'"}checked{/if} /><i></i>Recurring</label>
                    <label class="checkbox pull-left mr-10"><input type="checkbox" name="payment_mode_otp" value="1" {if="$payment_mode_otp=='1'"}checked{/if} /><i></i>One Time Charge</label>
                    <label class="checkbox pull-left mr-10"><input type="checkbox" name="payment_mode_mnl" value="1" {if="$payment_mode_mnl=='1'"}checked{/if} /><i></i>Manual Charge</label>
                	</section>                   
                    <section class="col col-3">
                        <label class="label">Search Keyword</label>
                        <label class="input">
                        	<input type="text" name="searchKeyword" value='{$searchKeyword}' placeholder="Order Ref. or Transaction ID" />
                        </label>
                    </section>
                    <section class="col col-2 cb">
                    	<label class="label">Duration</label>
                        <label class="select">
                          <select name="dd_frequency" id="dd_frequency" class="form-control" onchange="FromToDate($(this).val())" >                            
                          	<option value="1" {if="$dd_frequency==1"}selected{/if} >Today</option>
                            <option value="2" {if="$dd_frequency==2"}selected{/if} >Current Week</option>
                            <option value="3" {if="$dd_frequency==3"}selected{/if} >Current Month</option>
                            <option value="all" >By Calendar</option>
                          </select><i></i> 
                        </label>
                    </section>
                    <section class="col col-2">
                        <label class="label">Date Form</label>
                        <div class="input-append date" id="StartDate" data-date="" data-date-format="mm/dd/yyyy">
                            <label class="input"> <i class="icon-append fa fa-calendar add-on"></i>
                                <input type="text" class="datepickerInput" name="fromDate" id="FromDate" value='{function="formatDate($fromDate, 'm/d/Y')"}' readonly="readonly" />
                            </label>
                        </div>
                    </section>
                    <section class="col col-2 ">
                        <label class="label">To</label>
                        <div class="input-append date" id="EndDate" data-date="" data-date-format="mm/dd/yyyy">
                            <label class="input"> <i class="icon-append fa fa-calendar add-on"></i>
                                <input type="text" class="datepickerInput" name="toDate" id="ToDate" value='{function="formatDate($toDate, 'm/d/Y')"}' readonly="readonly" />
                            </label>
                        </div>
                    </section>
                   
                    <section class="col col-6 pull-right text-right mt-30">
                       <button type="submit" name="" value="" id="filter_donation" class="button-1" /><i class="fa fa-search"></i>&nbsp;Show Result</button> &nbsp; 
                        <a href='{#URL#}salesubscriptionreport' class="button-2"><i class="fa fa-refresh"></i>&nbsp;Reset</a>
                        {if condition="$totalRecord>0"} &nbsp; 
                        <a href='javascript://' id="export" class="button-2" onclick="ExportData()"><i class="fa fa-file-excel-o"></i>&nbsp;Export</a>
                        {/if}
                    </section>
                </div>
            </fieldset>            
        </div>
    </form>
    <div class="row">
        <section class="col col-12">
        	{if condition="$totalRecord>0"}
            <div class="record-found pull-left">Showing {$startRecord}-{$endRecord} of {$totalRecord} records</div>
            {/if}
              <table border="0" id="igs-table">
                <thead>
                <tr>
                	<th>Order Id/Date</th>
                    <th>Customer Name/Email</th>
                    <th>Service Name/Code</th>
                    <th>Payment Mode</th>
                    <th>Transaction ID</th>
                    <th>Amount</th>
                    <th>Status</th>
                    <th>Transaction Date</th>
                    <th>Action</th>
                </tr>
                <thead>
                <tbody>
                {if condition="$saleSubsReport!=NULL"}
                {loop="saleSubsReport"}
                    <tr>
                    	<td data-title="Order Id/Date">
                        	<span class="text-bold">{$value.SS_RefNumber}</span><br />
                            {function="formatDate($value.SS_DateTime, 'm/d/y h:ia')"}
                        </td>
                        <td data-title="Customer Name/Email">
                            <strong>{$value.SS_FirstName}&nbsp;{$value.SS_LastName}</strong>
                            {if="$value.SS_PaySimpleCustomerID!=''"}({$value.SS_PaySimpleCustomerID}){/if}<br />
                            {$value.SS_EmailAddress}
                        </td>
                        <td data-title="Service Name/Code">
                        	<span class="text-bold">{$value.SS_ItemName}</span><br />
                            {$value.SS_ItemCode}
                        </td>
                        <td data-title="Payment Mode">
                            {if="$value.SSPT_PaymentType=='RC'"}
                            {$value.SS_Schedule|ucfirst}<br />
                            Recurring
                            {elseif="$value.SSPT_PaymentType=='MNL'"}
                            Manual
                            {else}
                            One Time
                            {/if}
                        </td>
                        <td data-title="Transaction ID"> 
                            {$value.SSPT_PaymentGatewayTransactionID}
                        </td>
                        <td data-title="Amount($)">
                        	${$value.SSPT_PaymentAmount}
                        </td>
                        <td data-title="Status">
                            {if="$value.SSPT_Status==1"}Approved
                            {else}Declined{/if}                            
                        </td>
                        <td data-title="Transaction Date">
                            {function="formatDate($value.SSPT_CreatedDate, 'm/d/y h:ia')"}
                        </td>
                        <td data-title="Action">
                        	<a href='{#FRONTURL#}salesubscription/showTransactionReceipt/{$value.SSPT_ID|keyEncryptFront}' target="_new" title="Show Receipt for {$value.SS_RefNumber}" class="link-text">Show Receipt</a>
                        </td>
                    </tr>
                {/loop}
                {else}
                <tr>
                    <td class="text-center" colspan="9">Change filter criteria to get more details.</td>
                </tr>
                {/if}
                </tbody>
                
             </tbody>
          </table>
          {if condition="$totalRecord>0"}
          <!-- pagination start-->
            <div class="container">
                <div class="col col-12"> 
                    <nav>
                        <ul class="pagination">
                        {if="$pageSelected!=1"}
                        	<li> <a href='javascript://' onclick="return GotoPage(1);"  title="First Page" aria-label="Previous"> <span aria-hidden="true">First</span> </a> </li>
                        	<li> <a href='javascript://' onclick="return GotoPage({$pageSelected-1});"  title="Previous" aria-label="Previous"> <span aria-hidden="true">&laquo;</span> </a> </li>
                        {/if}
                        {if="count($pagingList)>1"}
                        {loop="pagingList"} 
                            {if="$pageSelected==$value.PageNo"}
                            <li class="active"><a href='javascript://' title="Page No {$value.PageNo}">{$value.PageNo}</a></li>
                            {else}
                            <li><a href='javascript://' onclick="return GotoPage({$value.PageNo});" title="Page No {$value.PageNo}">{$value.PageNo}</a></li>
                            {/if}
                        {/loop}
                        {/if}
                        {if="$pageSelected!=$lastPage"}
                        	<li> <a href='javascript://' onclick="return GotoPage({$pageSelected+1});" aria-label="Next"> <span aria-hidden="true">&raquo;</span> </a> </li>
                        	<li> <a href='javascript://' onclick="return GotoPage({$lastPage});" aria-label="Last Page"> Last </a> </li>
                        {/if}
                        </ul>
                    </nav>
                </div>
            </div>
            {/if}
        </section>
    </div>
</div>