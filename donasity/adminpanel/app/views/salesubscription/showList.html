<link type="text/css" rel="stylesheet" href='{#RESOURCES#}css/bootstrap-datepicker.css'>
<script type="text/javascript" src='{#RESOURCES#}js/bootstrap-datepicker.js'></script>
<script type="text/javascript">
	$(function() {
		$('#StartDate').datepicker();
		$('#StartDate').datepicker().on('changeDate', function (ev) {
			if(ev.viewMode == "days") {
				$('#StartDate').datepicker('hide');
				//maxDate: jQuery('#FromDate').datepicker("getDate");
			}
		});
		
		$('#EndDate').datepicker();
		$('#EndDate').datepicker().on('changeDate', function (ev) {
			if(ev.viewMode == "days") {
				$('#EndDate').datepicker('hide');
				//maxDate: jQuery('#ToDate').datepicker("getDate");
			}
		});
		
		{if="isset($dd_filter_by) && $dd_filter_by!=''"}
		var dd_filter_by = '{$dd_filter_by}';
		if(dd_filter_by != '')
		FromToDate('{$dd_filter_by}');
		{/if}
	});
	
	
	
	function FromToDate(filter_by) {
		var from_date = "{function="formatDate($fromDate, 'm/d/Y')"}";
		var to_date = "{function="formatDate($toDate, 'm/d/Y')"}";
		if(filter_by != '') {
			$('#FromDate').val(from_date);
			$('#ToDate').val(to_date);
		} else
			$('#FromDate, #ToDate').val('');
	}
</script>
<ul class="breadcrumb">
  <li title="Dashboard"><a href='{#URL#}home/'>Dashboard</a></li>
  <li title="Sale Subscription">Sale Subscription List</li>
</ul>
{include="common/message"}
<div class="oh">
  <div class="col col-4">
    <h1 class="heading-1">Sale Subscription - List</h1>
  </div>
  <div class="col col-7 text-right mt-15 pull-right"> <a href='{#URL#}salesubscription/newOrder' class="button-2" title="Add Order"><i class="fa fa-user"></i>&nbsp;Add Order</a> </div>
</div>
<div id="content-box" class="igs-form"> 
  <form id="formSection" name="formSection" method="get" autocomplete="off" action="">
    <input type="hidden" name="pageNumber" id="pageNumber" value="1" />
    <div class="section-heading">Filter Result <a href='javascript://' class="form-toggle-icon"><i class="fa fa-minus-square-o"></i></a></div>
    <div class="content-section">
        <fieldset>
            <div class="row">
                <section class="col col-3">
                    <label class="label">Status</label>
                    <label class="select">
                      <select name="dd_status" id="dd_status" class="form-control">
                        <option value="">All Status</option>
                        {if="$statusArray!=''"}
                        {loop="$statusGroupArray"}
                        <optgroup label="{$key}">
                        	{loop="$value"}
                        <option value="{$key}" {if="$dd_status==$key"}selected{/if} >{$value}</option>
                        	{/loop}
                        {/loop}
                        {/if}
                      </select><i></i> 
                    </label>
                </section>
                <section class="col col-3">
                    <label class="label">Service Type</label>
                    <label class="select">
                      <select name="dd_service_type" id="dd_service_type" class="form-control">
                        <option value="">All Service Type</option>
                        {if="$itemList!=''"}
                        {loop="$itemList"}
                        <option value="{$value.PI_ItemCode}" {if="$dd_service_type==$value.PI_ItemCode"}selected{/if} >{$value.PI_ItemName_EN}</option>
                        {/loop}
                        {/if}
                      </select><i></i> 
                    </label>
                </section>
                <section class="col col-2">
                    <label class="label">Filter By</label>
                    <label class="select">
                      <select name="dd_filter_by" id="dd_filter_by" class="form-control" onchange="FromToDate($(this).val())" >
                      	<option value="">Select filter by</option>
                        <option value="1" {if="$dd_filter_by=='1'"}selected{/if} >Order Date</option>
                        <option value="2" {if="$dd_filter_by=='2'"}selected{/if} >Next Recurring Date</option>
                      </select><i></i> 
                    </label>
                </section>
                <section class="col col-2">
                    <label class="label">Date Form</label>
                    <div class="input-append date" id="StartDate" data-date="" data-date-format="mm/dd/yyyy">
                        <label class="input"> <i class="icon-append fa fa-calendar add-on"></i>
                            <input type="text" class="datepickerInput" name="fromDate" id="FromDate" value='' readonly="readonly" />
                        </label>
                    </div>
                </section>
                <section class="col col-2 ">
                    <label class="label">To</label>
                    <div class="input-append date" id="EndDate" data-date="" data-date-format="mm/dd/yyyy">
                        <label class="input"> <i class="icon-append fa fa-calendar add-on"></i>
                            <input type="text" class="datepickerInput" name="toDate" id="ToDate" value='' readonly="readonly" />
                        </label>
                    </div>
                </section>
            </div>
            <div class="row">
            	<section class="col col-3">
                    <label class="label">Payment Mode</label>
                    <label class="checkbox"><input type="checkbox" name="payment_mode_rec" value="1" {if="$payment_mode_rec=='1'"}checked{/if} /><i></i>Recurring</label>
                    <label class="checkbox"><input type="checkbox" name="payment_mode_opt" value="1" {if="$payment_mode_opt=='1'"}checked{/if} /><i></i>One Time Payment</label>
                </section>
                <section class="col col-3 ">
                    <label class="label">Search Keyword</label>
                    <label class="input">
                        <input type="text" name="searchKeyword" value='{$searchKeyword}' placeholder="Search Keyword" />
                    </label>
                    <div class="note">Enter keyword to find Order#, Customer Number, Customer Email, Customer Name, Phone#</div>
                </section>
                <section class="col col-6 text-right pull-right mt-30">                
                    <button type="submit" name="" value="" id="filter_donation" class="button-1" /><i class="fa fa-search"></i>&nbsp;Show Result</button> &nbsp; 
            		<a href='{#URL#}salesubscription' class="button-2"><i class="fa fa-refresh"></i>&nbsp;Reset</a>
               
                </section>
            </div>
        </fieldset>
        <div class="form-footer">
            
        </div>
      </div>
    </form>
  <div class="row">
    <section class="col col-12">
      <div class="record-found pull-left">
      {if="$totalrecords>0"}
      Showing {$startRecord}-{$endRecord} of {$totalrecords} records
      {/if}
      </div>
      <table border="0" id="igs-table">
        <tr>
          <th>Order Id/Date</th>
          <th>Customer Name/Email</th>
          <th>Service Name/Code</th>
          <th>Amount</th>
          <th>Payment Mode</th>
          <th>Payment Dates</th>
          <th>Status</th>
          <th>Action</th>
        </tr>
        {if="$arraySaleSubDetails!=NULL"}
        {loop="$arraySaleSubDetails"}
        <tr>
          <td data-title="Order Id/Date">
          	<span class="text-bold">{$value.SS_RefNumber}</span><br />
            {$value.SS_DateTime|formatDate:'m/d/y h:ia'}
          </td>
          <td data-title="Customer Name/Email">
          	<strong>{$value.SS_FirstName} {$value.SS_LastName}	 </strong>
            {if="$value.SS_PaySimpleCustomerID!=''"} ({$value.SS_PaySimpleCustomerID}){/if}<br />
            {$value.SS_EmailAddress}
          </td>
          <td data-title="Service Name/Code">
          	<span class="text-bold">{$value.SS_ItemName}</span><br />
            {$value.SS_ItemCode}
          </td>
          <td data-title="Amount" >${$value.SS_Amount}</td>
          <td data-title="Payment Mode">
          	{if="$value.SS_PaymentMode=='RC'"}
            {$value.SS_Schedule|ucfirst}<br />
            Recurring
            {else}
            One Time
            {/if}
          </td>
          <td data-title="Payment Dates">
          	Last on 
          	{if="$value.SS_LastOuccringDate!=NULL && $value.SS_LastOuccringDate!='0000-00-00'"}
            {$value.SS_LastOuccringDate|formatDate:'m/d/y'}
            {else}
            -NA-
            {/if}<br />
            {if="$value.SS_PaymentMode=='RC'"}
            {if="$value.SS_Status!=16 && $value.SS_Status!=21"}
            Next on 
            {if="$value.SS_NextOuccringDate!=NULL && $value.SS_NextOuccringDate!='0000-00-00'"}
            {$value.SS_NextOuccringDate|formatDate:'m/d/y'}
            {else}
            -NA-
            {/if}
            {/if}
            {/if}
          </td>
          <td data-title="Status">
          {loop="$statusArray"}{if="$key==$value1.SS_Status"}{$value}{/if}{/loop}
          </td>
          <td data-title="Action" >
          	{if="$value.SS_Status==1"}
            <a href='{#URL#}salesubscription/editOrder/{$value.SS_ID|keyEncrypt}' class="link-text">Add Order</a>
            {elseif="$value.SS_Status>=2 && $value.SS_Status<=4"}
            <a href='{#URL#}salesubscription/order/{$value.SS_ID|keyEncrypt}' class="link-text">Add Payment</a>
            {elseif="$value.SS_Status>=11 && $value.SS_Status<=30"}
            <a href='{#URL#}salesubscription/order/{$value.SS_ID|keyEncrypt}' class="link-text">Edit Order/Payment</a>
            {/if}
            <!--<a href='{#URL#}recurringtransaction/Transaction/{$value.SS_ID|keyEncrypt}' title="Show Transaction" class="link-text">Transaction</a>-->
          </td>
        </tr>
        {/loop}
        {else}
        <tr>
          <td colspan="8" class="text-center">No Record Found.</td>
        </tr>
        {/if}
      </table>
    </section>
  </div>
  
  <!-- pagination start-->
  <div class="row">
    <div class="col col-12"> {if condition="count($PagingList)>1"}
      <nav>
        <ul class="pagination">
          {if="$PageSelected!=1"}
          <li> <a href='javascript://' onclick="return GotoPage(1);"  title="First Page" aria-label="Previous"> <span aria-hidden="true">First</span> </a> </li>
          <li> <a href='javascript://' onclick="return GotoPage({$PageSelected-1});"  title="Previous" aria-label="Previous"> <span aria-hidden="true">&laquo;</span> </a> </li>
          {/if}
          {loop="PagingList"} 
          {if="$PageSelected==$value.PageNo"}
          <li class="active"><a href='javascript://' title="Page No {$value.PageNo}">{$value.PageNo}</a></li>
          {else}
          <li><a href='javascript://' onclick="return GotoPage({$value.PageNo});" title="Page No {$value.PageNo}">{$value.PageNo}</a></li>
          {/if}   
          {/loop}
          {if="$PageSelected!=$lastPage"}
          <li> <a href='javascript://' onclick="return GotoPage({$PageSelected+1});" aria-label="Next"> <span aria-hidden="true">&raquo;</span> </a> </li>
          <li> <a href='javascript://' onclick="return GotoPage({$lastPage});" aria-label="Last Page"> Last </a> </li>
          {/if}
        </ul>
      </nav>
      {/if} </div>
  </div>
  <!-- pagination end--> 
</div>
